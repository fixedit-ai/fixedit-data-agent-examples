# Mock GitHub API Input Configuration for Testing
#
# This configuration uses Telegraf's file input plugin to simulate GitHub API
# responses for testing the complete pipeline without making actual API calls.
#
# Required Environment Variables:
# - HELPER_FILES_DIR: Directory containing sample JSON files
# - SAMPLE_FILE: JSON filename to use for testing (e.g., "sample.json", "test_files/sample_select_latest.json")
#
# Key Features:
# - Reads sample GitHub API response from local JSON file
# - Provides identical data structure to real GitHub API
# - Enables testing of processor and output logic independently
# - Allows development and testing without GitHub token or network access
# - Perfect for validating strobe control logic with known data

[[inputs.file]]
  # Path to sample GitHub API response file
  # SAMPLE_FILE should specify the JSON filename (relative to HELPER_FILES_DIR)
  # Examples: sample.json, sample_select_latest.json
  files = ["${HELPER_FILES_DIR}/${SAMPLE_FILE}"]

  # Parse file content as JSON format
  # Same parsing logic as used for real GitHub API responses
  data_format = "json"

  # Override metric name to match real GitHub input
  # This ensures processor configuration works identically with test data
  # Must match namepass filter in processor configuration
  name_override = "github_workflow"

  # Extract workflow_runs array from JSON response
  # GitHub API returns: {"total_count": N, "workflow_runs": [...]}
  # This query extracts just the workflow_runs array for processing
  json_query = "workflow_runs"

  # Fields to extract as tags for filtering and processing
  # Same tag extraction as real API to ensure consistent behavior
  # status: workflow execution state, conclusion: final result
  # name: workflow name (for filtering by GITHUB_WORKFLOW)
  tag_keys = ["status", "conclusion", "name"]

  # String fields to preserve (not just numeric values)
  # Maintains same field structure as real API input configuration
  # Useful for debugging and logging during testing
  json_string_fields = ["status", "conclusion", "name", "display_title", "id", "run_number"]