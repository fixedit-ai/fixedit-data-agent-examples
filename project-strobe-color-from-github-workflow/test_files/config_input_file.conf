# Mock GitHub API Input Configuration for Testing
#
# This configuration uses Telegraf's file input plugin to simulate GitHub API
# responses for testing the complete pipeline without making actual API calls.
#
# Key Features:
# - Reads sample GitHub API response from local JSON file
# - Provides identical data structure to real GitHub API
# - Enables testing of processor and output logic independently
# - Allows development and testing without GitHub token or network access
# - Perfect for validating strobe control logic with known data

[[inputs.file]]
  # Path to sample GitHub API response file
  # HELPER_FILES_DIR should point to directory containing sample.json
  # and is set automatically by the FixedIt Data Agent to the directory where
  # helper files are uploaded.
  files = ["${HELPER_FILES_DIR}/sample.json"]

  # Parse file content as JSON format
  # Same parsing logic as used for real GitHub API responses
  data_format = "json"

  # Override metric name to match real GitHub input
  # This ensures processor configuration works identically with test data
  # Must match namepass filter in processor configuration
  name_override = "github_workflow"

  # Extract workflow_runs array from JSON response
  # GitHub API returns: {"total_count": N, "workflow_runs": [...]}
  # This query extracts just the workflow_runs array for processing
  json_query = "workflow_runs"

  # Fields to extract as tags for filtering and processing
  # Same tag extraction as real API to ensure consistent behavior
  # status: workflow execution state, conclusion: final result
  tag_keys = ["status", "conclusion"]

  # String fields to preserve (not just numeric values)
  # Maintains same field structure as real API input configuration
  # Useful for debugging and logging during testing
  json_string_fields = ["status", "conclusion", "name", "display_title", "id", "run_number"]