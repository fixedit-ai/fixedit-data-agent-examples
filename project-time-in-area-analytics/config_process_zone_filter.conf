# Zone Filter Processor
#
# This processor filters detection frames based on a configured zone polygon.
# Only detections with bounding box centers inside the zone are passed through.
# If INCLUDE_ZONE_POLYGON is not set, all detections pass through unchanged.
#
# The zone polygon is defined in normalized coordinates [-1, 1]:
# - X-axis: -1 (left) to +1 (right)
# - Y-axis: -1 (bottom) to +1 (top)
#
# Input: detection_frame metrics from input processor
# Output: detection_frame_in_zone metrics (only those with centers inside the zone)
#
# Environment Variables:
# - INCLUDE_ZONE_POLYGON: JSON array of zones (required)
#   Format: [[vertex1, vertex2, vertex3, ...]]
#   Example: [[[-0.5,-0.5],[-0.5,0.5],[0.5,0.5],[0.5,-0.5]]]
#   Currently only supports a single zone (multi-zone planned for future)

[[processors.starlark]]
  # Only consume metrics with name "detection_frame"
  namepass = ["detection_frame"]

  # Path to Starlark script
  script = "${HELPER_FILES_DIR}/zone_filter.star"

  [processors.starlark.constants]
    zone_polygon_json = "${INCLUDE_ZONE_POLYGON}"
