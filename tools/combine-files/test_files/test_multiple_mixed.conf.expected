# ========================================
# From: test_multiple_mixed.conf
# ========================================

# Test multiple scripts and commands mixed
# Note: All entries for a given table array must be consecutive in TOML

[[inputs.cpu]]
  percpu = false
  totalcpu = true

[[processors.starlark]]
  source = '''
def apply(metric):
    metric.tags["processed"] = "true"
    return metric

'''

[[processors.starlark]]
  source = '''
def process(metric):
    metric.tags["processed_by"] = "script2"
    return metric

'''

[[outputs.execd]]
  command = ["sh", "-c", '''
tmpfile=$(mktemp)
trap 'rm -f "$tmpfile"' EXIT
openssl base64 -d -A <<'FIXEDIT_SCRIPT_EOF' >"$tmpfile"
IyEvYmluL3NoCmVjaG8gIlByb2Nlc3NpbmcgZGF0YSIKY2F0Cgo=
FIXEDIT_SCRIPT_EOF
sh "$tmpfile"''']

[[outputs.execd]]
  command = ["sh", "-c", '''
tmpfile=$(mktemp)
trap 'rm -f "$tmpfile"' EXIT
openssl base64 -d -A <<'FIXEDIT_SCRIPT_EOF' >"$tmpfile"
IyEvYmluL3NoCmVjaG8gIkhlbHBlciAyIgpjYXQKCg==
FIXEDIT_SCRIPT_EOF
sh "$tmpfile"''']

[[outputs.file]]
  files = ["stdout"]
